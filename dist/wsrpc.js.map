{"version":3,"file":"wsrpc.js","sources":["wsrpc.es6.js"],"sourcesContent":["class Deferred {\n\tconstructor() {\n\t\tconst self = this;\n\n\t\tself.resolve = null;\n\t\tself.reject = null;\n\t\tself.done = false;\n\n\t\tfunction wrapper(func) {\n\t\t\treturn function () {\n\t\t\t\tif (self.done) {\n\t\t\t\t\tconsole.error(new Error('Promise already done'));\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tself.done = true;\n\t\t\t\treturn func.apply(this, arguments);\n\t\t\t}\n\t\t}\n\n\t\tself.promise = new Promise(\n\t\t\t(resolve, reject) => {\n\t\t\t\tself.resolve = wrapper(resolve);\n\t\t\t\tself.reject = wrapper(reject);\n\t\t\t}\n\t\t);\n\n\t\tself.promise.isPending = () => { return !self.done };\n\t\treturn self;\n\t}\n}\n\nfunction logGroup(group, level, args) {\n\tconsole.group(group);\n\tconsole[level].apply(this, args);\n\tconsole.groupEnd();\n}\n\nfunction log() {\n\tif (!WSRPC.DEBUG) return;\n\tlogGroup('WSRPC.DEBUG', 'trace', arguments);\n}\n\nfunction trace (msg) {\n\tif (!WSRPC.TRACE) return;\n\n\tlet payload = msg;\n\tif ('data' in msg) payload = JSON.parse(msg.data);\n\tlogGroup(\"WSRPC.TRACE\", 'trace', [payload]);\n}\n\nfunction getAbsoluteWsUrl(url) {\n\tif ((/^\\w+:\\/\\//).test(url)) return url;\n\tif (typeof window == 'undefined' && window.location.host.length < 1)\n\t\tthrow new Error(\n\t\t\t`Can not construct absolute URL from ${window.location}`\n\t\t);\n\tconst scheme = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n\tconst port = window.location.port === '' ? `:${window.location.port}` : '';\n\tconst host = window.location.host;\n\tconst path = url.replace(/^\\/+/gm, '');\n\treturn `${scheme}//${host}${port}/${path}`;\n}\n\nfunction buildProxyMethodHandler(property){\n  return {\n    get: (handler, childProperty) => {\n      if (childProperty.startsWith('_')) {\n        return handler[childProperty];\n      }\n      const newProperty = property ? `${property}.${childProperty}` : childProperty;\n      return new Proxy(\n        handler,\n        buildProxyMethodHandler(newProperty),\n      );\n    },\n    apply: function (target, thisArg, args) {\n      return target(property, ...args);\n    },\n  };\n}\n\nconst readyState = Object.freeze({\n\t0: 'CONNECTING',\n\t1: 'OPEN',\n\t2: 'CLOSING',\n\t3: 'CLOSED'\n});\n\nclass WSRPC {\n\tconstructor (URL, reconnectTimeout = 1000) {\n\t\tlet self = this;\n\n\t\tURL = getAbsoluteWsUrl(URL);\n\n\t\tself.id = 1;\n\t\tself.eventId = 0;\n\t\tself.socketStarted = false;\n\t\tself.eventStore = {\n\t\t\tonconnect: {},\n\t\t\tonerror: {},\n\t\t\tonclose: {},\n\t\t\tonchange: {}\n\t\t};\n\t\tself.connectionNumber = 0;\n\t\tself.oneTimeEventStore = {\n\t\t\tonconnect: [],\n\t\t\tonerror: [],\n\t\t\tonclose: [],\n\t\t\tonchange: []\n\t\t};\n\n\t\tself.callQueue = [];\n\n\t\tfunction createSocket() {\n\t\t\tlet ws = new WebSocket(URL);\n\n\t\t\tlet rejectQueue = function () {\n\t\t\t\tself.connectionNumber++; // rejects incoming calls\n\t\t\t\tlet deferred;\n\n\t\t\t\t//reject all pending calls\n\t\t\t\twhile (0 < self.callQueue.length) {\n\t\t\t\t\tlet callObj = self.callQueue.shift();\n\t\t\t\t\tdeferred = self.store[callObj.id];\n\t\t\t\t\tdelete self.store[callObj.id];\n\n\t\t\t\t\tif (deferred && deferred.promise.isPending()) {\n\t\t\t\t\t\tdeferred.reject('WebSocket error occurred');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// reject all from the store\n\t\t\t\tfor (let key in self.store) {\n\t\t\t\t\tif (!self.store.hasOwnProperty(key)) continue;\n\n\t\t\t\t\tdeferred = self.store[key];\n\t\t\t\t\tif (deferred && deferred.promise.isPending()) {\n\t\t\t\t\t\tdeferred.reject('WebSocket error occurred');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfunction reconnect(callEvents) {\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tself.socket = createSocket();\n\t\t\t\t\t\tself.id = 1;\n\t\t\t\t\t} catch (exc) {\n\t\t\t\t\t\tcallEvents('onerror', exc);\n\t\t\t\t\t\tdelete self.socket;\n\t\t\t\t\t\tconsole.error(exc);\n\t\t\t\t\t}\n\t\t\t\t}, reconnectTimeout);\n\t\t\t}\n\n\t\t\tws.onclose = function (err) {\n\t\t\t\tlog('ONCLOSE CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(err);\n\n\t\t\t\tfor (let serial in self.store) {\n\t\t\t\t\tif (!self.store.hasOwnProperty(serial)) continue;\n\t\t\t\t\tif (self.store[serial].hasOwnProperty('reject')) {\n\t\t\t\t\t\tself.store[serial].reject('Connection closed');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\trejectQueue();\n\t\t\t\tcallEvents('onclose', err);\n\t\t\t\tcallEvents('onchange', err);\n\t\t\t\treconnect(callEvents);\n\t\t\t};\n\n\t\t\tws.onerror = function (err) {\n\t\t\t\tlog('ONERROR CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(err);\n\n\t\t\t\trejectQueue();\n\t\t\t\tcallEvents('onerror', err);\n\t\t\t\tcallEvents('onchange', err);\n\n\t\t\t\tlog('WebSocket has been closed by error: ', err);\n\t\t\t};\n\n\t\t\tfunction tryCallEvent(func, event) {\n\t\t\t\ttry {\n\t\t\t\t\treturn func(event);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tif (e.hasOwnProperty('stack')) {\n\t\t\t\t\t\tlog(e.stack);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlog('Event function', func, 'raised unknown error:', e);\n\t\t\t\t\t}\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction callEvents(evName, event) {\n\t\t\t\twhile (0 < self.oneTimeEventStore[evName].length) {\n\t\t\t\t\tlet deferred = self.oneTimeEventStore[evName].shift();\n\t\t\t\t\tif (deferred.hasOwnProperty('resolve') &&\n\t\t\t\t\t\tdeferred.promise.isPending()) deferred.resolve();\n\t\t\t\t}\n\n\t\t\t\tfor (let i in self.eventStore[evName]) {\n\t\t\t\t\tif (!self.eventStore[evName].hasOwnProperty(i)) continue;\n\t\t\t\t\tlet cur = self.eventStore[evName][i];\n\t\t\t\t\ttryCallEvent(cur, event);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tws.onopen = function (ev) {\n\t\t\t\tlog('ONOPEN CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(ev);\n\n\t\t\t\twhile (0 < self.callQueue.length) {\n\t\t\t\t\t// noinspection JSUnresolvedFunction\n\t\t\t\t\tself.socket.send(JSON.stringify(self.callQueue.shift(), 0, 1));\n\t\t\t\t}\n\n\t\t\t\tcallEvents('onconnect', ev);\n\t\t\t\tcallEvents('onchange', ev);\n\t\t\t};\n\n\t\t\tfunction handleCall(self, data) {\n\t\t\t\tif (!self.routes.hasOwnProperty(data.method))\n\t\t\t\t\tthrow new Error('Route not found');\n\n\t\t\t\tlet connectionNumber = self.connectionNumber;\n\t\t\t\tlet deferred = new Deferred();\n\n\t\t\t\tdeferred.promise.then(\n\t\t\t\t\tfunction (result) {\n\t\t\t\t\t\tif (connectionNumber !== self.connectionNumber) return;\n\t\t\t\t\t\tself.socket.send(JSON.stringify({\n\t\t\t\t\t\t\tid: data.id,\n\t\t\t\t\t\t\tresult: result || null\n\t\t\t\t\t\t}));\n\t\t\t\t\t},\n\t\t\t\t\tfunction (error) {\n\t\t\t\t\t\tif (connectionNumber !== self.connectionNumber) return;\n\t\t\t\t\t\tself.socket.send(JSON.stringify({\n\t\t\t\t\t\t\tid: data.id,\n\t\t\t\t\t\t\terror: error || null\n\t\t\t\t\t\t}));\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\t\tlet func = self.routes[data.method];\n\n\t\t\t\tif (self.asyncRoutes[data.method])\n\t\t\t\t\treturn func.apply(deferred, [data.params]);\n\n\t\t\t\tfunction badPromise() {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\"You should register route with async flag.\"\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlet promiseMock = {\n\t\t\t\t\tresolve: badPromise,\n\t\t\t\t\treject: badPromise,\n\t\t\t\t};\n\n\t\t\t\ttry {\n\t\t\t\t\tdeferred.resolve(func.apply(promiseMock, [data.params]));\n\t\t\t\t} catch (e) {\n\t\t\t\t\tdeferred.reject(e);\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction handleError(self, data) {\n\t\t\t\tif (!self.store.hasOwnProperty(data.id))\n\t\t\t\t\treturn log('Unknown callback');\n\n\t\t\t\tlet deferred = self.store[data.id];\n\n\t\t\t\tif (typeof deferred === 'undefined')\n\t\t\t\t\treturn log('Confirmation without handler');\n\n\t\t\t\tdelete self.store[data.id];\n\t\t\t\tlog('REJECTING', data.error);\n\t\t\t\tdeferred.reject(data.error);\n\t\t\t}\n\n\t\t\tfunction handleResult(self, data) {\n\t\t\t\tlet deferred = self.store[data.id];\n\t\t\t\tif (typeof deferred === 'undefined')\n\t\t\t\t\treturn log('Confirmation without handler');\n\n\t\t\t\tdelete self.store[data.id];\n\n\t\t\t\tif (data.hasOwnProperty('result')) {\n\t\t\t\t\treturn deferred.resolve(data.result);\n\t\t\t\t}\n\t\t\t\treturn deferred.reject(data.error);\n\t\t\t}\n\n\t\t\tws.onmessage = function (message) {\n\t\t\t\tlog('ONMESSAGE CALLED', 'STATE', self.public.state());\n\t\t\t\ttrace(message);\n\n\t\t\t\tif (message.type !== 'message') return;\n\n\t\t\t\tlet data;\n\n\t\t\t\ttry {\n\t\t\t\t\tdata = JSON.parse(message.data);\n\t\t\t\t\tlog(data);\n\n\t\t\t\t\tif (!data.hasOwnProperty('id')) {\n\t\t\t\t\t\tlet current;\n\n\t\t\t\t\t\tconsole.group(\"Event received\");\n\t\t\t\t\t\tfor (let i = 0; i < self.socketEventsListeners.length; i++) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tcurrent = self.socketEventsListeners[i];\n\t\t\t\t\t\t\t\tcurrent.apply(self.public, [data]);\n\t\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconsole.groupEnd();\n\t\t\t\t\t} else if (data.hasOwnProperty('method')) {\n\t\t\t\t\t\treturn handleCall(self, data);\n\t\t\t\t\t} else if (data.hasOwnProperty('error') && data.error === null) {\n\t\t\t\t\t\treturn handleError(self, data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn handleResult(self, data);\n\t\t\t\t\t}\n\t\t\t\t} catch (exception) {\n\t\t\t\t\tlet err = {\n\t\t\t\t\t\terror: exception.message,\n\t\t\t\t\t\tresult: null,\n\t\t\t\t\t\tid: data ? data.id : null\n\t\t\t\t\t};\n\n\t\t\t\t\tself.socket.send(JSON.stringify(err));\n\t\t\t\t\tconsole.error(exception);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\treturn ws;\n\t\t}\n\n\t\tfunction makeCall(func, args, params) {\n\t\t\tself.id += 2;\n\t\t\tlet deferred = new Deferred();\n\n\t\t\tlet callObj = Object.freeze({\n\t\t\t\tid: self.id,\n\t\t\t\tmethod: func,\n\t\t\t\tparams: args\n\t\t\t});\n\n\t\t\tlet state = self.public.state();\n\n\t\t\tif (state === 'OPEN') {\n\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\tself.socket.send(JSON.stringify(callObj));\n\t\t\t} else if (state === 'CONNECTING') {\n\t\t\t\tlog('SOCKET IS', state);\n\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\tself.callQueue.push(callObj);\n\t\t\t} else {\n\t\t\t\tlog('SOCKET IS', state);\n\t\t\t\tif (params && params['noWait']) {\n\t\t\t\t\tdeferred.reject(`Socket is: ${state}`);\n\t\t\t\t} else {\n\t\t\t\t\tself.store[self.id] = deferred;\n\t\t\t\t\tself.callQueue.push(callObj);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn deferred.promise;\n\t\t}\n\n\t\tself.socketEventsListeners = [function (event) {console.log(event);}];\n\t\tself.asyncRoutes = {};\n\t\tself.routes = {};\n\t\tself.store = {};\n\t\tself.public = Object.freeze({\n            defer: function () {\n                return new Deferred();\n            },\n\t\t\tcall: function (func, args, params) {\n\t\t\t\treturn makeCall(func, args, params);\n\t\t\t},\n\t\t\tproxy: new Proxy(makeCall, buildProxyMethodHandler()),\n\t\t\taddRoute: function (route, callback, isAsync) {\n\t\t\t\tself.asyncRoutes[route] = isAsync || false;\n\t\t\t\tself.routes[route] = callback;\n\t\t\t},\n\t\t\tdeleteRoute: function (route) {\n\t\t\t\tdelete self.asyncRoutes[route];\n\t\t\t\treturn delete self.routes[route];\n\t\t\t},\n\t\t\taddEventListener: function (event, func) {\n\t\t\t\tlet eventId = self.eventId++;\n\t\t\t\tself.eventStore[event][eventId] = func;\n\t\t\t\treturn eventId;\n\t\t\t},\n\t\t\tremoveEventListener: function (event, index) {\n\t\t\t\tif (self.eventStore[event].hasOwnProperty(index)) {\n\t\t\t\t\tdelete self.eventStore[event][index];\n\t\t\t\t\treturn true;\n\t\t\t\t} else {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEvent: function (event) {\n\t\t\t\tlet deferred = new Deferred();\n\t\t\t\tself.oneTimeEventStore[event].push(deferred);\n\t\t\t\treturn deferred.promise;\n\t\t\t},\n\t\t\tdestroy: function () {\n\t\t\t\treturn self.socket.close();\n\t\t\t},\n\t\t\tstate: function () {\n\t\t\t\treturn readyState[this.stateCode()];\n\t\t\t},\n\t\t\tstateCode: function () {\n\t\t\t\tif (self.socketStarted && self.socket)\n\t\t\t\t\treturn self.socket.readyState;\n\t\t\t\treturn 3;\n\t\t\t},\n\t\t\tconnect: function () {\n\t\t\t\tself.socketStarted = true;\n\t\t\t\tself.socket = createSocket();\n\t\t\t},\n\t\t\taddServerEventListener: function (callable) {\n\t\t\t\treturn self.socketEventsListeners.push(callable) - 1;\n\t\t\t},\n\t\t\tremoveServerEventListener: function (index) {\n\t\t\t    return self.socketEventsListeners.splice(index, 1).length;\n\t\t\t},\n            sendRaw: function (data) {\n                return self.socket.send(data);\n            }\n\t\t});\n\n\t\tself.public.addRoute('log', function (argsObj) {\n\t\t\tconsole.info(`Websocket sent: ${argsObj}`);\n\t\t});\n\n\t\tself.public.addRoute('ping', function (data) {\n\t\t\treturn data;\n\t\t});\n\n\t\treturn self.public;\n\t}\n}\n\nWSRPC.DEBUG = false;\nWSRPC.TRACE = false;\n\nexport default WSRPC;\n"],"names":["Deferred","self","resolve","reject","done","wrapper","func","console","error","Error","apply","arguments","promise","Promise","isPending","logGroup","group","level","args","groupEnd","log","WSRPC","DEBUG","trace","msg","TRACE","payload","JSON","parse","data","getAbsoluteWsUrl","url","test","window","location","host","length","scheme","protocol","port","path","replace","buildProxyMethodHandler","property","get","handler","childProperty","startsWith","newProperty","Proxy","target","thisArg","readyState","Object","freeze","URL","reconnectTimeout","id","eventId","socketStarted","eventStore","onconnect","onerror","onclose","onchange","connectionNumber","oneTimeEventStore","callQueue","createSocket","ws","WebSocket","rejectQueue","deferred","callObj","shift","store","key","hasOwnProperty","reconnect","callEvents","setTimeout","socket","exc","err","public","state","serial","tryCallEvent","event","e","stack","evName","i","cur","onopen","ev","send","stringify","handleCall","routes","method","then","result","asyncRoutes","params","badPromise","promiseMock","handleError","handleResult","onmessage","message","type","current","socketEventsListeners","exception","makeCall","push","defer","call","proxy","addRoute","route","callback","isAsync","deleteRoute","addEventListener","removeEventListener","index","onEvent","destroy","close","stateCode","connect","addServerEventListener","callable","removeServerEventListener","splice","sendRaw","argsObj","info"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAAMA,WACL,oBAAc;EAAA;;EACb,MAAMC,IAAI,GAAG,IAAb;EAEAA,EAAAA,IAAI,CAACC,OAAL,GAAe,IAAf;EACAD,EAAAA,IAAI,CAACE,MAAL,GAAc,IAAd;EACAF,EAAAA,IAAI,CAACG,IAAL,GAAY,KAAZ;;EAEA,WAASC,OAAT,CAAiBC,IAAjB,EAAuB;EACtB,WAAO,YAAY;EAClB,UAAIL,IAAI,CAACG,IAAT,EAAe;EACdG,QAAAA,OAAO,CAACC,KAAR,CAAc,IAAIC,KAAJ,CAAU,sBAAV,CAAd;EACA;EACA;;EACDR,MAAAA,IAAI,CAACG,IAAL,GAAY,IAAZ;EACA,aAAOE,IAAI,CAACI,KAAL,CAAW,IAAX,EAAiBC,SAAjB,CAAP;EACA,KAPD;EAQA;;EAEDV,EAAAA,IAAI,CAACW,OAAL,GAAe,IAAIC,OAAJ,CACd,UAACX,OAAD,EAAUC,MAAV,EAAqB;EACpBF,IAAAA,IAAI,CAACC,OAAL,GAAeG,OAAO,CAACH,OAAD,CAAtB;EACAD,IAAAA,IAAI,CAACE,MAAL,GAAcE,OAAO,CAACF,MAAD,CAArB;EACA,GAJa,CAAf;;EAOAF,EAAAA,IAAI,CAACW,OAAL,CAAaE,SAAb,GAAyB,YAAM;EAAE,WAAO,CAACb,IAAI,CAACG,IAAb;EAAmB,GAApD;;EACA,SAAOH,IAAP;EACA;;EAGF,SAASc,QAAT,CAAkBC,KAAlB,EAAyBC,KAAzB,EAAgCC,IAAhC,EAAsC;EACrCX,EAAAA,OAAO,CAACS,KAAR,CAAcA,KAAd;EACAT,EAAAA,OAAO,CAACU,KAAD,CAAP,CAAeP,KAAf,CAAqB,IAArB,EAA2BQ,IAA3B;EACAX,EAAAA,OAAO,CAACY,QAAR;EACA;;EAED,SAASC,GAAT,GAAe;EACd,MAAI,CAACC,KAAK,CAACC,KAAX,EAAkB;EAClBP,EAAAA,QAAQ,CAAC,aAAD,EAAgB,OAAhB,EAAyBJ,SAAzB,CAAR;EACA;;EAED,SAASY,KAAT,CAAgBC,GAAhB,EAAqB;EACpB,MAAI,CAACH,KAAK,CAACI,KAAX,EAAkB;EAElB,MAAIC,OAAO,GAAGF,GAAd;EACA,MAAI,UAAUA,GAAd,EAAmBE,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWJ,GAAG,CAACK,IAAf,CAAV;EACnBd,EAAAA,QAAQ,CAAC,aAAD,EAAgB,OAAhB,EAAyB,CAACW,OAAD,CAAzB,CAAR;EACA;;EAED,SAASI,gBAAT,CAA0BC,GAA1B,EAA+B;EAC9B,MAAK,WAAD,CAAcC,IAAd,CAAmBD,GAAnB,CAAJ,EAA6B,OAAOA,GAAP;EAC7B,MAAI,OAAOE,MAAP,IAAiB,WAAjB,IAAgCA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,CAAqBC,MAArB,GAA8B,CAAlE,EACC,MAAM,IAAI3B,KAAJ,+CACkCwB,MAAM,CAACC,QADzC,EAAN;EAGD,MAAMG,MAAM,GAAGJ,MAAM,CAACC,QAAP,CAAgBI,QAAhB,KAA6B,QAA7B,GAAwC,MAAxC,GAAiD,KAAhE;EACA,MAAMC,IAAI,GAAGN,MAAM,CAACC,QAAP,CAAgBK,IAAhB,KAAyB,EAAzB,cAAkCN,MAAM,CAACC,QAAP,CAAgBK,IAAlD,IAA2D,EAAxE;EACA,MAAMJ,IAAI,GAAGF,MAAM,CAACC,QAAP,CAAgBC,IAA7B;EACA,MAAMK,IAAI,GAAGT,GAAG,CAACU,OAAJ,CAAY,QAAZ,EAAsB,EAAtB,CAAb;EACA,mBAAUJ,MAAV,eAAqBF,IAArB,SAA4BI,IAA5B,cAAoCC,IAApC;EACA;;EAED,SAASE,uBAAT,CAAiCC,QAAjC,EAA0C;EACxC,SAAO;EACLC,IAAAA,GAAG,EAAE,aAACC,OAAD,EAAUC,aAAV,EAA4B;EAC/B,UAAIA,aAAa,CAACC,UAAd,CAAyB,GAAzB,CAAJ,EAAmC;EACjC,eAAOF,OAAO,CAACC,aAAD,CAAd;EACD;;EACD,UAAME,WAAW,GAAGL,QAAQ,aAAMA,QAAN,cAAkBG,aAAlB,IAAoCA,aAAhE;EACA,aAAO,IAAIG,KAAJ,CACLJ,OADK,EAELH,uBAAuB,CAACM,WAAD,CAFlB,CAAP;EAID,KAVI;EAWLtC,IAAAA,KAAK,EAAE,eAAUwC,MAAV,EAAkBC,OAAlB,EAA2BjC,IAA3B,EAAiC;EACtC,aAAOgC,MAAM,MAAN,UAAOP,QAAP,4BAAoBzB,IAApB,GAAP;EACD;EAbI,GAAP;EAeD;;EAED,IAAMkC,UAAU,GAAGC,MAAM,CAACC,MAAP,CAAc;EAChC,KAAG,YAD6B;EAEhC,KAAG,MAF6B;EAGhC,KAAG,SAH6B;EAIhC,KAAG;EAJ6B,CAAd,CAAnB;;MAOMjC,QACL,eAAakC,GAAb,EAA2C;EAAA,MAAzBC,gBAAyB,uEAAN,IAAM;;EAAA;;EAC1C,MAAIvD,IAAI,GAAG,IAAX;EAEAsD,EAAAA,GAAG,GAAGzB,gBAAgB,CAACyB,GAAD,CAAtB;EAEAtD,EAAAA,IAAI,CAACwD,EAAL,GAAU,CAAV;EACAxD,EAAAA,IAAI,CAACyD,OAAL,GAAe,CAAf;EACAzD,EAAAA,IAAI,CAAC0D,aAAL,GAAqB,KAArB;EACA1D,EAAAA,IAAI,CAAC2D,UAAL,GAAkB;EACjBC,IAAAA,SAAS,EAAE,EADM;EAEjBC,IAAAA,OAAO,EAAE,EAFQ;EAGjBC,IAAAA,OAAO,EAAE,EAHQ;EAIjBC,IAAAA,QAAQ,EAAE;EAJO,GAAlB;EAMA/D,EAAAA,IAAI,CAACgE,gBAAL,GAAwB,CAAxB;EACAhE,EAAAA,IAAI,CAACiE,iBAAL,GAAyB;EACxBL,IAAAA,SAAS,EAAE,EADa;EAExBC,IAAAA,OAAO,EAAE,EAFe;EAGxBC,IAAAA,OAAO,EAAE,EAHe;EAIxBC,IAAAA,QAAQ,EAAE;EAJc,GAAzB;EAOA/D,EAAAA,IAAI,CAACkE,SAAL,GAAiB,EAAjB;;EAEA,WAASC,YAAT,GAAwB;EACvB,QAAIC,EAAE,GAAG,IAAIC,SAAJ,CAAcf,GAAd,CAAT;;EAEA,QAAIgB,WAAW,GAAG,SAAdA,WAAc,GAAY;EAC7BtE,MAAAA,IAAI,CAACgE,gBAAL,GAD6B;;EAE7B,UAAIO,QAAJ,CAF6B;;EAK7B,aAAO,IAAIvE,IAAI,CAACkE,SAAL,CAAe/B,MAA1B,EAAkC;EACjC,YAAIqC,OAAO,GAAGxE,IAAI,CAACkE,SAAL,CAAeO,KAAf,EAAd;EACAF,QAAAA,QAAQ,GAAGvE,IAAI,CAAC0E,KAAL,CAAWF,OAAO,CAAChB,EAAnB,CAAX;EACA,eAAOxD,IAAI,CAAC0E,KAAL,CAAWF,OAAO,CAAChB,EAAnB,CAAP;;EAEA,YAAIe,QAAQ,IAAIA,QAAQ,CAAC5D,OAAT,CAAiBE,SAAjB,EAAhB,EAA8C;EAC7C0D,UAAAA,QAAQ,CAACrE,MAAT,CAAgB,0BAAhB;EACA;EACD,OAb4B;;;EAgB7B,WAAK,IAAIyE,GAAT,IAAgB3E,IAAI,CAAC0E,KAArB,EAA4B;EAC3B,YAAI,CAAC1E,IAAI,CAAC0E,KAAL,CAAWE,cAAX,CAA0BD,GAA1B,CAAL,EAAqC;EAErCJ,QAAAA,QAAQ,GAAGvE,IAAI,CAAC0E,KAAL,CAAWC,GAAX,CAAX;;EACA,YAAIJ,QAAQ,IAAIA,QAAQ,CAAC5D,OAAT,CAAiBE,SAAjB,EAAhB,EAA8C;EAC7C0D,UAAAA,QAAQ,CAACrE,MAAT,CAAgB,0BAAhB;EACA;EACD;EACD,KAxBD;;EA0BA,aAAS2E,SAAT,CAAmBC,UAAnB,EAA+B;EAC9BC,MAAAA,UAAU,CAAC,YAAY;EACtB,YAAI;EACH/E,UAAAA,IAAI,CAACgF,MAAL,GAAcb,YAAY,EAA1B;EACAnE,UAAAA,IAAI,CAACwD,EAAL,GAAU,CAAV;EACA,SAHD,CAGE,OAAOyB,GAAP,EAAY;EACbH,UAAAA,UAAU,CAAC,SAAD,EAAYG,GAAZ,CAAV;EACA,iBAAOjF,IAAI,CAACgF,MAAZ;EACA1E,UAAAA,OAAO,CAACC,KAAR,CAAc0E,GAAd;EACA;EACD,OATS,EASP1B,gBATO,CAAV;EAUA;;EAEDa,IAAAA,EAAE,CAACN,OAAH,GAAa,UAAUoB,GAAV,EAAe;EAC3B/D,MAAAA,GAAG,CAAC,gBAAD,EAAmB,OAAnB,EAA4BnB,IAAI,CAACmF,MAAL,CAAYC,KAAZ,EAA5B,CAAH;EACA9D,MAAAA,KAAK,CAAC4D,GAAD,CAAL;;EAEA,WAAK,IAAIG,MAAT,IAAmBrF,IAAI,CAAC0E,KAAxB,EAA+B;EAC9B,YAAI,CAAC1E,IAAI,CAAC0E,KAAL,CAAWE,cAAX,CAA0BS,MAA1B,CAAL,EAAwC;;EACxC,YAAIrF,IAAI,CAAC0E,KAAL,CAAWW,MAAX,EAAmBT,cAAnB,CAAkC,QAAlC,CAAJ,EAAiD;EAChD5E,UAAAA,IAAI,CAAC0E,KAAL,CAAWW,MAAX,EAAmBnF,MAAnB,CAA0B,mBAA1B;EACA;EACD;;EAEDoE,MAAAA,WAAW;EACXQ,MAAAA,UAAU,CAAC,SAAD,EAAYI,GAAZ,CAAV;EACAJ,MAAAA,UAAU,CAAC,UAAD,EAAaI,GAAb,CAAV;EACAL,MAAAA,SAAS,CAACC,UAAD,CAAT;EACA,KAfD;;EAiBAV,IAAAA,EAAE,CAACP,OAAH,GAAa,UAAUqB,GAAV,EAAe;EAC3B/D,MAAAA,GAAG,CAAC,gBAAD,EAAmB,OAAnB,EAA4BnB,IAAI,CAACmF,MAAL,CAAYC,KAAZ,EAA5B,CAAH;EACA9D,MAAAA,KAAK,CAAC4D,GAAD,CAAL;EAEAZ,MAAAA,WAAW;EACXQ,MAAAA,UAAU,CAAC,SAAD,EAAYI,GAAZ,CAAV;EACAJ,MAAAA,UAAU,CAAC,UAAD,EAAaI,GAAb,CAAV;EAEA/D,MAAAA,GAAG,CAAC,sCAAD,EAAyC+D,GAAzC,CAAH;EACA,KATD;;EAWA,aAASI,YAAT,CAAsBjF,IAAtB,EAA4BkF,KAA5B,EAAmC;EAClC,UAAI;EACH,eAAOlF,IAAI,CAACkF,KAAD,CAAX;EACA,OAFD,CAEE,OAAOC,CAAP,EAAU;EACX,YAAIA,CAAC,CAACZ,cAAF,CAAiB,OAAjB,CAAJ,EAA+B;EAC9BzD,UAAAA,GAAG,CAACqE,CAAC,CAACC,KAAH,CAAH;EACA,SAFD,MAEO;EACNtE,UAAAA,GAAG,CAAC,gBAAD,EAAmBd,IAAnB,EAAyB,uBAAzB,EAAkDmF,CAAlD,CAAH;EACA;;EACDlF,QAAAA,OAAO,CAACC,KAAR,CAAciF,CAAd;EACA;EACD;;EAED,aAASV,UAAT,CAAoBY,MAApB,EAA4BH,KAA5B,EAAmC;EAClC,aAAO,IAAIvF,IAAI,CAACiE,iBAAL,CAAuByB,MAAvB,EAA+BvD,MAA1C,EAAkD;EACjD,YAAIoC,QAAQ,GAAGvE,IAAI,CAACiE,iBAAL,CAAuByB,MAAvB,EAA+BjB,KAA/B,EAAf;EACA,YAAIF,QAAQ,CAACK,cAAT,CAAwB,SAAxB,KACHL,QAAQ,CAAC5D,OAAT,CAAiBE,SAAjB,EADD,EAC+B0D,QAAQ,CAACtE,OAAT;EAC/B;;EAED,WAAK,IAAI0F,CAAT,IAAc3F,IAAI,CAAC2D,UAAL,CAAgB+B,MAAhB,CAAd,EAAuC;EACtC,YAAI,CAAC1F,IAAI,CAAC2D,UAAL,CAAgB+B,MAAhB,EAAwBd,cAAxB,CAAuCe,CAAvC,CAAL,EAAgD;EAChD,YAAIC,GAAG,GAAG5F,IAAI,CAAC2D,UAAL,CAAgB+B,MAAhB,EAAwBC,CAAxB,CAAV;EACAL,QAAAA,YAAY,CAACM,GAAD,EAAML,KAAN,CAAZ;EACA;EACD;;EAEDnB,IAAAA,EAAE,CAACyB,MAAH,GAAY,UAAUC,EAAV,EAAc;EACzB3E,MAAAA,GAAG,CAAC,eAAD,EAAkB,OAAlB,EAA2BnB,IAAI,CAACmF,MAAL,CAAYC,KAAZ,EAA3B,CAAH;EACA9D,MAAAA,KAAK,CAACwE,EAAD,CAAL;;EAEA,aAAO,IAAI9F,IAAI,CAACkE,SAAL,CAAe/B,MAA1B,EAAkC;EACjC;EACAnC,QAAAA,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBrE,IAAI,CAACsE,SAAL,CAAehG,IAAI,CAACkE,SAAL,CAAeO,KAAf,EAAf,EAAuC,CAAvC,EAA0C,CAA1C,CAAjB;EACA;;EAEDK,MAAAA,UAAU,CAAC,WAAD,EAAcgB,EAAd,CAAV;EACAhB,MAAAA,UAAU,CAAC,UAAD,EAAagB,EAAb,CAAV;EACA,KAXD;;EAaA,aAASG,UAAT,CAAoBjG,IAApB,EAA0B4B,IAA1B,EAAgC;EAC/B,UAAI,CAAC5B,IAAI,CAACkG,MAAL,CAAYtB,cAAZ,CAA2BhD,IAAI,CAACuE,MAAhC,CAAL,EACC,MAAM,IAAI3F,KAAJ,CAAU,iBAAV,CAAN;EAED,UAAIwD,gBAAgB,GAAGhE,IAAI,CAACgE,gBAA5B;EACA,UAAIO,QAAQ,GAAG,IAAIxE,QAAJ,EAAf;EAEAwE,MAAAA,QAAQ,CAAC5D,OAAT,CAAiByF,IAAjB,CACC,UAAUC,MAAV,EAAkB;EACjB,YAAIrC,gBAAgB,KAAKhE,IAAI,CAACgE,gBAA9B,EAAgD;EAChDhE,QAAAA,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBrE,IAAI,CAACsE,SAAL,CAAe;EAC/BxC,UAAAA,EAAE,EAAE5B,IAAI,CAAC4B,EADsB;EAE/B6C,UAAAA,MAAM,EAAEA,MAAM,IAAI;EAFa,SAAf,CAAjB;EAIA,OAPF,EAQC,UAAU9F,KAAV,EAAiB;EAChB,YAAIyD,gBAAgB,KAAKhE,IAAI,CAACgE,gBAA9B,EAAgD;EAChDhE,QAAAA,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBrE,IAAI,CAACsE,SAAL,CAAe;EAC/BxC,UAAAA,EAAE,EAAE5B,IAAI,CAAC4B,EADsB;EAE/BjD,UAAAA,KAAK,EAAEA,KAAK,IAAI;EAFe,SAAf,CAAjB;EAIA,OAdF;EAiBA,UAAIF,IAAI,GAAGL,IAAI,CAACkG,MAAL,CAAYtE,IAAI,CAACuE,MAAjB,CAAX;EAEA,UAAInG,IAAI,CAACsG,WAAL,CAAiB1E,IAAI,CAACuE,MAAtB,CAAJ,EACC,OAAO9F,IAAI,CAACI,KAAL,CAAW8D,QAAX,EAAqB,CAAC3C,IAAI,CAAC2E,MAAN,CAArB,CAAP;;EAED,eAASC,UAAT,GAAsB;EACrB,cAAM,IAAIhG,KAAJ,CACL,4CADK,CAAN;EAGA;;EAED,UAAIiG,WAAW,GAAG;EACjBxG,QAAAA,OAAO,EAAEuG,UADQ;EAEjBtG,QAAAA,MAAM,EAAEsG;EAFS,OAAlB;;EAKA,UAAI;EACHjC,QAAAA,QAAQ,CAACtE,OAAT,CAAiBI,IAAI,CAACI,KAAL,CAAWgG,WAAX,EAAwB,CAAC7E,IAAI,CAAC2E,MAAN,CAAxB,CAAjB;EACA,OAFD,CAEE,OAAOf,CAAP,EAAU;EACXjB,QAAAA,QAAQ,CAACrE,MAAT,CAAgBsF,CAAhB;EACAlF,QAAAA,OAAO,CAACC,KAAR,CAAciF,CAAd;EACA;EACD;;EAED,aAASkB,WAAT,CAAqB1G,IAArB,EAA2B4B,IAA3B,EAAiC;EAChC,UAAI,CAAC5B,IAAI,CAAC0E,KAAL,CAAWE,cAAX,CAA0BhD,IAAI,CAAC4B,EAA/B,CAAL,EACC,OAAOrC,GAAG,CAAC,kBAAD,CAAV;EAED,UAAIoD,QAAQ,GAAGvE,IAAI,CAAC0E,KAAL,CAAW9C,IAAI,CAAC4B,EAAhB,CAAf;EAEA,UAAI,OAAOe,QAAP,KAAoB,WAAxB,EACC,OAAOpD,GAAG,CAAC,8BAAD,CAAV;EAED,aAAOnB,IAAI,CAAC0E,KAAL,CAAW9C,IAAI,CAAC4B,EAAhB,CAAP;EACArC,MAAAA,GAAG,CAAC,WAAD,EAAcS,IAAI,CAACrB,KAAnB,CAAH;EACAgE,MAAAA,QAAQ,CAACrE,MAAT,CAAgB0B,IAAI,CAACrB,KAArB;EACA;;EAED,aAASoG,YAAT,CAAsB3G,IAAtB,EAA4B4B,IAA5B,EAAkC;EACjC,UAAI2C,QAAQ,GAAGvE,IAAI,CAAC0E,KAAL,CAAW9C,IAAI,CAAC4B,EAAhB,CAAf;EACA,UAAI,OAAOe,QAAP,KAAoB,WAAxB,EACC,OAAOpD,GAAG,CAAC,8BAAD,CAAV;EAED,aAAOnB,IAAI,CAAC0E,KAAL,CAAW9C,IAAI,CAAC4B,EAAhB,CAAP;;EAEA,UAAI5B,IAAI,CAACgD,cAAL,CAAoB,QAApB,CAAJ,EAAmC;EAClC,eAAOL,QAAQ,CAACtE,OAAT,CAAiB2B,IAAI,CAACyE,MAAtB,CAAP;EACA;;EACD,aAAO9B,QAAQ,CAACrE,MAAT,CAAgB0B,IAAI,CAACrB,KAArB,CAAP;EACA;;EAED6D,IAAAA,EAAE,CAACwC,SAAH,GAAe,UAAUC,OAAV,EAAmB;EACjC1F,MAAAA,GAAG,CAAC,kBAAD,EAAqB,OAArB,EAA8BnB,IAAI,CAACmF,MAAL,CAAYC,KAAZ,EAA9B,CAAH;EACA9D,MAAAA,KAAK,CAACuF,OAAD,CAAL;EAEA,UAAIA,OAAO,CAACC,IAAR,KAAiB,SAArB,EAAgC;EAEhC,UAAIlF,IAAJ;;EAEA,UAAI;EACHA,QAAAA,IAAI,GAAGF,IAAI,CAACC,KAAL,CAAWkF,OAAO,CAACjF,IAAnB,CAAP;EACAT,QAAAA,GAAG,CAACS,IAAD,CAAH;;EAEA,YAAI,CAACA,IAAI,CAACgD,cAAL,CAAoB,IAApB,CAAL,EAAgC;EAC/B,cAAImC,OAAJ;EAEAzG,UAAAA,OAAO,CAACS,KAAR,CAAc,gBAAd;;EACA,eAAK,IAAI4E,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG3F,IAAI,CAACgH,qBAAL,CAA2B7E,MAA/C,EAAuDwD,CAAC,EAAxD,EAA4D;EAC3D,gBAAI;EACHoB,cAAAA,OAAO,GAAG/G,IAAI,CAACgH,qBAAL,CAA2BrB,CAA3B,CAAV;EACAoB,cAAAA,OAAO,CAACtG,KAAR,CAAcT,IAAI,CAACmF,MAAnB,EAA2B,CAACvD,IAAD,CAA3B;EACA,aAHD,CAGE,OAAO4D,CAAP,EAAU;EACXlF,cAAAA,OAAO,CAACC,KAAR,CAAciF,CAAd;EACA;EACD;;EACDlF,UAAAA,OAAO,CAACY,QAAR;EACA,SAbD,MAaO,IAAIU,IAAI,CAACgD,cAAL,CAAoB,QAApB,CAAJ,EAAmC;EACzC,iBAAOqB,UAAU,CAACjG,IAAD,EAAO4B,IAAP,CAAjB;EACA,SAFM,MAEA,IAAIA,IAAI,CAACgD,cAAL,CAAoB,OAApB,KAAgChD,IAAI,CAACrB,KAAL,KAAe,IAAnD,EAAyD;EAC/D,iBAAOmG,WAAW,CAAC1G,IAAD,EAAO4B,IAAP,CAAlB;EACA,SAFM,MAEA;EACN,iBAAO+E,YAAY,CAAC3G,IAAD,EAAO4B,IAAP,CAAnB;EACA;EACD,OAxBD,CAwBE,OAAOqF,SAAP,EAAkB;EACnB,YAAI/B,GAAG,GAAG;EACT3E,UAAAA,KAAK,EAAE0G,SAAS,CAACJ,OADR;EAETR,UAAAA,MAAM,EAAE,IAFC;EAGT7C,UAAAA,EAAE,EAAE5B,IAAI,GAAGA,IAAI,CAAC4B,EAAR,GAAa;EAHZ,SAAV;EAMAxD,QAAAA,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBrE,IAAI,CAACsE,SAAL,CAAed,GAAf,CAAjB;EACA5E,QAAAA,OAAO,CAACC,KAAR,CAAc0G,SAAd;EACA;EACD,KA1CD;;EA4CA,WAAO7C,EAAP;EACA;;EAED,WAAS8C,QAAT,CAAkB7G,IAAlB,EAAwBY,IAAxB,EAA8BsF,MAA9B,EAAsC;EACrCvG,IAAAA,IAAI,CAACwD,EAAL,IAAW,CAAX;EACA,QAAIe,QAAQ,GAAG,IAAIxE,QAAJ,EAAf;EAEA,QAAIyE,OAAO,GAAGpB,MAAM,CAACC,MAAP,CAAc;EAC3BG,MAAAA,EAAE,EAAExD,IAAI,CAACwD,EADkB;EAE3B2C,MAAAA,MAAM,EAAE9F,IAFmB;EAG3BkG,MAAAA,MAAM,EAAEtF;EAHmB,KAAd,CAAd;EAMA,QAAImE,KAAK,GAAGpF,IAAI,CAACmF,MAAL,CAAYC,KAAZ,EAAZ;;EAEA,QAAIA,KAAK,KAAK,MAAd,EAAsB;EACrBpF,MAAAA,IAAI,CAAC0E,KAAL,CAAW1E,IAAI,CAACwD,EAAhB,IAAsBe,QAAtB;EACAvE,MAAAA,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBrE,IAAI,CAACsE,SAAL,CAAexB,OAAf,CAAjB;EACA,KAHD,MAGO,IAAIY,KAAK,KAAK,YAAd,EAA4B;EAClCjE,MAAAA,GAAG,CAAC,WAAD,EAAciE,KAAd,CAAH;EACApF,MAAAA,IAAI,CAAC0E,KAAL,CAAW1E,IAAI,CAACwD,EAAhB,IAAsBe,QAAtB;EACAvE,MAAAA,IAAI,CAACkE,SAAL,CAAeiD,IAAf,CAAoB3C,OAApB;EACA,KAJM,MAIA;EACNrD,MAAAA,GAAG,CAAC,WAAD,EAAciE,KAAd,CAAH;;EACA,UAAImB,MAAM,IAAIA,MAAM,CAAC,QAAD,CAApB,EAAgC;EAC/BhC,QAAAA,QAAQ,CAACrE,MAAT,sBAA8BkF,KAA9B;EACA,OAFD,MAEO;EACNpF,QAAAA,IAAI,CAAC0E,KAAL,CAAW1E,IAAI,CAACwD,EAAhB,IAAsBe,QAAtB;EACAvE,QAAAA,IAAI,CAACkE,SAAL,CAAeiD,IAAf,CAAoB3C,OAApB;EACA;EACD;;EAED,WAAOD,QAAQ,CAAC5D,OAAhB;EACA;;EAEDX,EAAAA,IAAI,CAACgH,qBAAL,GAA6B,CAAC,UAAUzB,KAAV,EAAiB;EAACjF,IAAAA,OAAO,CAACa,GAAR,CAAYoE,KAAZ;EAAoB,GAAvC,CAA7B;EACAvF,EAAAA,IAAI,CAACsG,WAAL,GAAmB,EAAnB;EACAtG,EAAAA,IAAI,CAACkG,MAAL,GAAc,EAAd;EACAlG,EAAAA,IAAI,CAAC0E,KAAL,GAAa,EAAb;EACA1E,EAAAA,IAAI,CAACmF,MAAL,GAAc/B,MAAM,CAACC,MAAP,CAAc;EAClB+D,IAAAA,KAAK,EAAE,iBAAY;EACf,aAAO,IAAIrH,QAAJ,EAAP;EACH,KAHiB;EAI3BsH,IAAAA,IAAI,EAAE,cAAUhH,IAAV,EAAgBY,IAAhB,EAAsBsF,MAAtB,EAA8B;EACnC,aAAOW,QAAQ,CAAC7G,IAAD,EAAOY,IAAP,EAAasF,MAAb,CAAf;EACA,KAN0B;EAO3Be,IAAAA,KAAK,EAAE,IAAItE,KAAJ,CAAUkE,QAAV,EAAoBzE,uBAAuB,EAA3C,CAPoB;EAQ3B8E,IAAAA,QAAQ,EAAE,kBAAUC,KAAV,EAAiBC,QAAjB,EAA2BC,OAA3B,EAAoC;EAC7C1H,MAAAA,IAAI,CAACsG,WAAL,CAAiBkB,KAAjB,IAA0BE,OAAO,IAAI,KAArC;EACA1H,MAAAA,IAAI,CAACkG,MAAL,CAAYsB,KAAZ,IAAqBC,QAArB;EACA,KAX0B;EAY3BE,IAAAA,WAAW,EAAE,qBAAUH,KAAV,EAAiB;EAC7B,aAAOxH,IAAI,CAACsG,WAAL,CAAiBkB,KAAjB,CAAP;EACA,aAAO,OAAOxH,IAAI,CAACkG,MAAL,CAAYsB,KAAZ,CAAd;EACA,KAf0B;EAgB3BI,IAAAA,gBAAgB,EAAE,0BAAUrC,KAAV,EAAiBlF,IAAjB,EAAuB;EACxC,UAAIoD,OAAO,GAAGzD,IAAI,CAACyD,OAAL,EAAd;EACAzD,MAAAA,IAAI,CAAC2D,UAAL,CAAgB4B,KAAhB,EAAuB9B,OAAvB,IAAkCpD,IAAlC;EACA,aAAOoD,OAAP;EACA,KApB0B;EAqB3BoE,IAAAA,mBAAmB,EAAE,6BAAUtC,KAAV,EAAiBuC,KAAjB,EAAwB;EAC5C,UAAI9H,IAAI,CAAC2D,UAAL,CAAgB4B,KAAhB,EAAuBX,cAAvB,CAAsCkD,KAAtC,CAAJ,EAAkD;EACjD,eAAO9H,IAAI,CAAC2D,UAAL,CAAgB4B,KAAhB,EAAuBuC,KAAvB,CAAP;EACA,eAAO,IAAP;EACA,OAHD,MAGO;EACN,eAAO,KAAP;EACA;EACD,KA5B0B;EA6B3BC,IAAAA,OAAO,EAAE,iBAAUxC,KAAV,EAAiB;EACzB,UAAIhB,QAAQ,GAAG,IAAIxE,QAAJ,EAAf;EACAC,MAAAA,IAAI,CAACiE,iBAAL,CAAuBsB,KAAvB,EAA8B4B,IAA9B,CAAmC5C,QAAnC;EACA,aAAOA,QAAQ,CAAC5D,OAAhB;EACA,KAjC0B;EAkC3BqH,IAAAA,OAAO,EAAE,mBAAY;EACpB,aAAOhI,IAAI,CAACgF,MAAL,CAAYiD,KAAZ,EAAP;EACA,KApC0B;EAqC3B7C,IAAAA,KAAK,EAAE,iBAAY;EAClB,aAAOjC,UAAU,CAAC,KAAK+E,SAAL,EAAD,CAAjB;EACA,KAvC0B;EAwC3BA,IAAAA,SAAS,EAAE,qBAAY;EACtB,UAAIlI,IAAI,CAAC0D,aAAL,IAAsB1D,IAAI,CAACgF,MAA/B,EACC,OAAOhF,IAAI,CAACgF,MAAL,CAAY7B,UAAnB;EACD,aAAO,CAAP;EACA,KA5C0B;EA6C3BgF,IAAAA,OAAO,EAAE,mBAAY;EACpBnI,MAAAA,IAAI,CAAC0D,aAAL,GAAqB,IAArB;EACA1D,MAAAA,IAAI,CAACgF,MAAL,GAAcb,YAAY,EAA1B;EACA,KAhD0B;EAiD3BiE,IAAAA,sBAAsB,EAAE,gCAAUC,QAAV,EAAoB;EAC3C,aAAOrI,IAAI,CAACgH,qBAAL,CAA2BG,IAA3B,CAAgCkB,QAAhC,IAA4C,CAAnD;EACA,KAnD0B;EAoD3BC,IAAAA,yBAAyB,EAAE,mCAAUR,KAAV,EAAiB;EACxC,aAAO9H,IAAI,CAACgH,qBAAL,CAA2BuB,MAA3B,CAAkCT,KAAlC,EAAyC,CAAzC,EAA4C3F,MAAnD;EACH,KAtD0B;EAuDlBqG,IAAAA,OAAO,EAAE,iBAAU5G,IAAV,EAAgB;EACrB,aAAO5B,IAAI,CAACgF,MAAL,CAAYe,IAAZ,CAAiBnE,IAAjB,CAAP;EACH;EAzDiB,GAAd,CAAd;EA4DA5B,EAAAA,IAAI,CAACmF,MAAL,CAAYoC,QAAZ,CAAqB,KAArB,EAA4B,UAAUkB,OAAV,EAAmB;EAC9CnI,IAAAA,OAAO,CAACoI,IAAR,2BAAgCD,OAAhC;EACA,GAFD;EAIAzI,EAAAA,IAAI,CAACmF,MAAL,CAAYoC,QAAZ,CAAqB,MAArB,EAA6B,UAAU3F,IAAV,EAAgB;EAC5C,WAAOA,IAAP;EACA,GAFD;EAIA,SAAO5B,IAAI,CAACmF,MAAZ;EACA;;EAGF/D,KAAK,CAACC,KAAN,GAAc,KAAd;EACAD,KAAK,CAACI,KAAN,GAAc,KAAd;;;;;;;;"}